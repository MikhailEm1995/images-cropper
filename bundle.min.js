"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return a}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}var global={};!function(e){var t=(e.modules||{}).elements,a=((t=void 0===t?{}:t).ELEMENTS,t.NODES,{listeners:{},subscribe:function(e,t){this.listeners.hasOwnProperty(e)?this.listeners[e].push(t):this.listeners[e]=[t]},publish:function(e,t){this.listeners.hasOwnProperty(e)&&this.listeners[e].forEach(function(e){_instanceof(e,Function)&&e(t)})}}),n={data:{},has:function(e){return this.data.hasOwnProperty(e)},initSet:function(e){var t=this;this.data[e].set=function(n,i){t.data[e][n]=i,a.publish("".concat(e,"-").concat(n),i)}},init:function(e){this.data[e]={},this.initSet(e)}};e.modules={...e.modules||{},utils:{state:n,mediator:a}}}(global),function(e){var t=document.getElementById("imageCropper"),a={CONTAINER:"container",CONTROLS:"controls",UPLOAD:"upload",MAX_WIDTH:"maxWidth",MAX_HEIGHT:"maxHeight",IS_RECT:"isRect",IS_ELLIPSE:"isEllipse",SAVE:"save",IMAGE:"image",PRELOADER:"preloader",NOTIFICATIONS:"notifications"},n=Object.entries(a).reduce(function(e,a){var n=_slicedToArray(a,2),i=n[0],r=n[1],o='[data-element="'.concat(r,'"]');return _defineProperty({...e},i,t.querySelector(o))},{});e.modules={...e.modules||{},elements:{ELEMENTS:a,NODES:{...n,APP:t}}}}(global),function(e){var t=(e.modules||{}).elements,a=(t=void 0===t?{}:t).ELEMENTS,n=void 0===a?{}:a,i=t.NODES,r=void 0===i?{}:i;function o(e){return function(t){var a=e.data[n.UPLOAD];a.cropper?a.cropper.replace(t):(r.IMAGE.src=t,a.set("cropper",new Cropper(r.IMAGE)))}}e.modules={...e.modules||{},handlers:{uploadImage:function(e){return e.has(n.UPLOAD)||e.init(n.UPLOAD),function(t){var a=t.target.files,i=new FileReader,r=a[0];i.onloadend=function(){e.data[n.UPLOAD].set("file",i.result)},r&&i.readAsDataURL(r)}},setMaxWidth:function(e){return e.has(n.MAX_WIDTH)||e.init(n.MAX_WIDTH),function(t){var a=t.target.value;e.data[n.MAX_WIDTH].set("value",a)}},setMaxHeight:function(e){return e.has(n.MAX_HEIGHT)||e.init(n.MAX_HEIGHT),function(t){var a=t.target.value;e.data[n.MAX_HEIGHT].set("value",a)}},setIsEllipse:function(e){return e.has(n.IS_ELLIPSE)||e.init(n.IS_ELLIPSE),function(){e.data[n.IS_ELLIPSE].set("value",!0)}},setIsRect:function(e){return e.has(n.IS_ELLIPSE)||e.init(n.IS_ELLIPSE),function(){e.data[n.IS_ELLIPSE].set("value",!1)}},saveImage:function(e){return e.has(n.SAVE)||e.init(n.SAVE),function(){if(e.data[n.UPLOAD].cropper){e.data[n.SAVE].set("isLoading",!0),function(e){var t=e.data[n.IS_ELLIPSE].value;if(!e.data[n.UPLOAD]||!e.data[n.UPLOAD].cropper)return null;var a=e.data[n.UPLOAD].cropper,i=a.getData(),r=(i.x,i.y,i.width),s=i.height,c=a.getCroppedCanvas(),l=(t?function(e,t,a,n,i){var r=document.createElement("canvas");r.setAttribute("width",n),r.setAttribute("height",i);var o=r.getContext("2d");return o.drawImage(e,0,0),o.save(),o.globalCompositeOperation="destination-in",o.ellipse(n/2,i/2,n/2,i/2,0,0,360),o.fill(),o.restore(),r}(c,0,0,r,s):c).toDataURL("image/png");o(e)(l)}(e);var t=e.data[n.MAX_WIDTH].value||1/0,a=e.data[n.MAX_HEIGHT].value||1/0;r.IMAGE.addEventListener("ready",function i(){e.data[n.UPLOAD].cropper.getCroppedCanvas({maxWidth:t,maxHeight:a}).toBlob(function(t){var a=new FormData;a.append("croppedImage",t),fetch("http://localhost:8080",{method:"POST",header:{"Content-Type":"multipart/form-data"},body:a}).then(function(){e.data[n.SAVE].set("isLoading",!1),e.data[n.NOTIFICATIONS].set("notification",{type:"success",message:"âœ” The image successfully saved"})}).catch(function(){e.data[n.SAVE].set("isLoading",!1),e.data[n.NOTIFICATIONS].set("notification",{type:"fail",message:"Error. Couldn't save the image"})})}),r.IMAGE.removeEventListener("ready",i)})}else e.data[n.NOTIFICATIONS].set("notification",{type:"fail",message:"No image to save"})}},initImageCropper:o,updateImageCropperForm:function(e){var t=r.APP.classList.contains("image-cropper--ellipse");e&&t||!e&&!t||(e?r.APP.classList.add("image-cropper--ellipse"):r.APP.classList.remove("image-cropper--ellipse"))},handlePreloader:function(e){var t=r.PRELOADER.classList;e&&t.contains("image-cropper__preloader--visible")||!e&&!t.contains("image-cropper__preloader--visible")||(e?t.add("image-cropper__preloader--visible"):t.remove("image-cropper__preloader--visible"))},handleNotifications:function(e){e.has(n.NOTIFICATIONS)||e.init(n.NOTIFICATIONS);var t=null;return function(e){var a=e.type,n=e.message;clearInterval(t),r.NOTIFICATIONS.innerHTML="";var i=document.createElement("div");i.classList.add("image-cropper__notification"),i.classList.add("image-cropper__notification--".concat(a)),i.innerHTML=n,r.NOTIFICATIONS.appendChild(i),t=setTimeout(function(){r.NOTIFICATIONS.innerHTML="",t=null},4e3)}}}}}(global),function(e){var t=function(){},a=function(){return function(){}},n=e.modules||{},i=n.elements,r=(i=void 0===i?{}:i).ELEMENTS,o=void 0===r?{}:r,s=i.NODES,c=void 0===s?{}:s,l=n.handlers,d=(l=void 0===l?{}:l).uploadImage,u=void 0===d?a:d,p=l.setMaxWidth,I=void 0===p?a:p,v=l.setMaxHeight,f=void 0===v?a:v,E=l.setIsEllipse,m=void 0===E?a:E,h=l.setIsRect,L=void 0===h?a:h,A=l.saveImage,g=void 0===A?a:A,S=l.initImageCropper,T=void 0===S?a:S,O=l.handleNotifications,_=void 0===O?a:O,P=l.updateImageCropperForm,b=void 0===P?t:P,y=l.handlePreloader,N=void 0===y?t:y,C=n.utils,D=C.state,M=C.mediator;M.subscribe("".concat(o.UPLOAD,"-file"),T(D)),M.subscribe("".concat(o.IS_ELLIPSE,"-value"),b),M.subscribe("".concat(o.SAVE,"-isLoading"),N),M.subscribe("".concat(o.NOTIFICATIONS,"-notification"),_(D)),c.UPLOAD.addEventListener("change",u(D)),c.MAX_WIDTH.addEventListener("change",I(D)),c.MAX_HEIGHT.addEventListener("change",f(D)),c.IS_ELLIPSE.addEventListener("click",m(D)),c.IS_RECT.addEventListener("click",L(D)),c.SAVE.addEventListener("click",g(D))}(global);